## Тестовое задание для компании Ришат
Приложение можно протестировать на [тестовом сервере](http://85.193.91.121:8080/item/1/)

## Задание
Реализовать Django + Stripe API бэкенд со следующим функционалом и условиями:

· 	Django Модель Item с полями (name, description, price)
API с двумя методами:

· 	GET /buy/{id}, c помощью которого можно получить Stripe Session Id для оплаты выбранного Item. При выполнении этого метода c бэкенда с помощью python библиотеки stripe должен выполняться запрос stripe.checkout.Session.create(...) и полученный session.id выдаваться в результате запроса

· 	GET /item/{id}, c помощью которого можно получить простейшую HTML страницу, на которой будет информация о выбранном Item и кнопка Buy. По нажатию на кнопку Buy должен происходить запрос на /buy/{id}, получение session_id и далее с помощью JS библиотеки Stripe происходить редирект на Checkout форму stripe.redirectToCheckout(sessionId=session_id)

Бонусные задачи

· 	Запуск используя Docker

· 	Использование environment variables

· 	Просмотр Django Моделей в Django Admin панели

· 	Запуск приложения на удаленном сервере, доступном для тестирования

· 	Модель Order, в которой можно объединить несколько Item и сделать платёж в Stripe на содержимое Order c общей стоимостью всех Items

· 	Модели Discount, Tax, которые можно прикрепить к модели Order и связать с соответствующими атрибутами при создании платежа в Stripe - в таком случае они корректно отображаются в Stripe Checkout форме.

· 	Добавить поле Item.currency, создать 2 Stripe Keypair на две разные валюты и в зависимости от валюты выбранного товара предлагать оплату в соответствующей валюте


## Решение
В решении использованы Django, DjangoRestFramework, база данных PostgreSQL, Docker. Созданы модели для всех сущностей, при создании с помощью библиотеки stripe генерируются связанные с ними модели и поля, хранящие соответствующие stripe значения. С помощью APIView созданы необходимые endpoint-ы, написаны сериализаторы для сериализации моделей в необходимом для stripe формате. С помощью сессии реализовано добавление разных продуктов в заказ. Приложение можно запустить с помощью Docker-а


### Запуск приложения с помощью Docker
В корне проекта создайте **.env** файл и пропишите в нем следующие переменные:
```
DB_NAME=app
DB_USER=postgres
DB_PASSWORD=supersecretpassword
DB_HOST=db

DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@yandex.ru
DJANGO_SUPERUSER_PASSWORD=admin

STRIPE_KEY=*ваш Stripe Secret Key*
STRIPE_PUBLISH_KEY=*ваш Stripe Publish Key*
```
Затем мы запускаем приложение следующей Docker командой в терминале:
```
docker-compose up -d
```
Приложение запуститься и должно быть доступно по локальному адресу [127.0.0.1:8000](http://127.0.0.1:8000)

Остановить приложение/запустить заново:
```
docker-compose stop
docker-compose start
```
Остановить приложение и удалить все связанные контейнеры, включая базу данных:
```
docker-compose down -v
```
При изменениях в коде проекта, необходимо заново создать образ и запустить сервисы:
```
docker-compose build
docker-compose up -d
```

### Запуск приложения без использования Docker
Сначала в корне проекта создадим виртуальное окружение и активируем его:
```
python3 -m venv venv
source venv/bin/activate
```
Затем установим все зависимости проекта, отдав следующую команду:
```
pip install -r requirements.txt
```
После этого в корне проекта создайте **.env** файл и пропишите в нем следующие переменные:
```
DB_NAME= название вашей базы данных
DB_USER= имя пользователя
DB_PASSWORD= пароль пользователя
DB_HOST=localhost

STRIPE_KEY= ваш Stripe Secret Key
STRIPE_PUBLISH_KEY= ваш Stripe Publish Key
```
***Убедитесь, что PostgreSQL запущен на локальной машине и принимает соединения на порту 5432***

Затем в корне проекта отдаем следующие команды, применяя миграции к базе данных:
```
python3 manage.py makemigrations
python3 manage.py migrate
```
Затем в интерактивном режиме создаем суперпользователя, чтобы иметь доступ к админ-панели:
```
python3 manage.py createsuperuser
```
После этого можно запускать сервер следующей командой:
```
python3 manage.py runserver
```
Приложение запуститься и должно быть доступно по локальному адресу [127.0.0.1:8000](http://127.0.0.1:8000)
